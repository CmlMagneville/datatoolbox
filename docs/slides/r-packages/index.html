<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Du script au package R</title>
    <meta charset="utf-8" />
    <meta name="author" content="  Nicolas CASAJUS .inst[{{ Data scientist FRB-Cesab }}]" />
    <link href="assets/libs/font-awesome-5.3.1/css/fontawesome-all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../../assets/css/xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="../../assets/css/custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: right, middle, title-slide

# Du script au package R
## <i>il n’y a qu’un pas…</i>
### <br /><br />Nicolas CASAJUS<br />.inst[{{ Data scientist FRB-Cesab }}]
### .inst[Jeudi 5 décembre 2019]

---



class: inverse, center, middle

## Résumé de la semaine


## Initialisation d'un project git

.center[![:scale 80%](assets/img/project02.png)]

- Ne pas oublier de versionner tout au long du projet



---

## Ajout de fichiers

.center[![:scale 80%](assets/img/project04.png)]

- Développement _classique_ du projet



---

## Formatage et nettoyage

.center[![:scale 80%](assets/img/project06.png)]

- Respect des "conventions" dans les noms des fichiers
- Et à l'intérieur de ces fichiers...



---

## Restructuration du project

.center[![:scale 80%](assets/img/project08.png)]

- Réorganisation du projet selon l'approche `research compendium`



---

## Reproductibilité

.center[![:scale 80%](assets/img/project10.png)]

- Analyses et notes dans un même document : `rmarkdown`



---

## Optimisation du code

.center[![:scale 80%](assets/img/project12.png)]

- Développement de fonctions R dans un dossier à part : `R/`



---

## Documentation des fonctions

.center[![:scale 80%](assets/img/project14.png)]

- Documentation des fonctions : titre, paramètres, exemple reproductible, etc.



---

## Package R

.center[![:scale 80%](assets/img/project16.png)]

- Rajout de fichiers essentiels pour une structure en package :
  - `DESCRIPTION` : Métadonnées du package
  - `NAMESPACE` : Directives pour les fonctions/dépendances
  - `LICENSE` : Licence d'utilisation du package



---

## Et pourquoi pas une vignette ?

.center[![:scale 80%](assets/img/project18.png)]

- `Vignette` : fichier `rmd` montrant l'utilisation du package



---

class: inverse, center, middle

## Construction d'un package R

&lt;br /&gt;

.center[
  ![:scale 15%](assets/img/hex-devtools.png)
  &amp;nbsp;&amp;nbsp;&amp;nbsp;
  ![:scale 15%](assets/img/hex-usethis.png)
  &amp;nbsp;&amp;nbsp;&amp;nbsp;
  ![:scale 15%](assets/img/hex-roxygen2.png)
]

---


## Qu'est-ce qu'un package ?

- <i class="fas  fa-quote-left "></i> &amp;nbsp;_In R, the fundamental unit of
shareable code is the package. A package bundles together code, data,
documentation, and tests, and is easy to share with others_ (**Hadley Wickham**)

- 15 278 packages sur le [**CRAN**](https://cran.r-project.org) (consulté le 24/11/2019)

--

- Ressources :

.pull-left[
  .center[[![:scale 50%](assets/img/r-pkg.png)](http://r-pkgs.had.co.nz)]
]

.pull-right[
  .center[[![:scale 49.2%](assets/img/r-ext.jpg)](https://cran.r-project.org/doc/manuals/r-release/R-exts.html)]
]



---

## Cas d'étude

- Nous allons créer un package simple nommé `{pkgmin}`

- Il contiendra une seule fonction : `moyenne()`

- Nous y associerons également un jeu de données

- Il dépendra de deux autres packages : `{magrittr}` et `{stats}`

&lt;br /&gt;

<i class="fas  fa-hand-point-right "></i> &amp;nbsp;Le nom d'un package ne doit contenir que des caractères alphanumériques (le point est autorisé)


---

## Création du squelette

- Commençons par créer l'arborescence minimale de notre package

--


```r
usethis::create_package("/Users/nicolascasajus/Desktop/pkgmin")
```


```
## ✔ Creating '/Users/nicolascasajus/Desktop/pkgmin/'
## ✔ Setting active project to '/Users/nicolascasajus/Desktop/pkgmin'
## ✔ Creating 'R/'
## ✔ Writing 'DESCRIPTION'
## Package: pkgmin
## Title: What the Package Does (One Line, Title Case)
## Version: 0.0.0.9000
## Authors@R (parsed):
##     * First Last &lt;first.last@example.com&gt; [aut, cre] (&lt;https://orcid.org/YOUR-ORCID-ID&gt;)
## Description: What the package does (one paragraph).
## License: What license it uses
## Encoding: UTF-8
## LazyData: true
## ✔ Writing 'NAMESPACE'
## ✔ Setting active project to '&lt;no active project&gt;'
```

&lt;!--

```r
dir(all.files = TRUE)
```


```
## [1] "DESCRIPTION" "NAMESPACE"   "R"
```
--&gt;


---

## Initialisation du versioning

- Poursuivons en transformant ce dossier en dépôt `git`



```r
usethis::use_git()
```


```
## ✔ Setting active project to '/Users/nicolascasajus/Desktop/pkgmin'
## ✔ Initialising Git repo
## ✔ Adding '.Rhistory', '.RData', '.Rproj.user' to '.gitignore'
```

--

&lt;br /&gt;


```r
dir(all.files = TRUE)
```


```
## [1] ".git"        ".gitignore"  "DESCRIPTION" "NAMESPACE"   "R"
```



---

## Métadonnées du package

- Avant d'aller plus loin, il est d'usage de modifier le fichier `DESCRIPTION`


```r
usethis::edit_file("DESCRIPTION")
```


```
## ● Edit 'DESCRIPTION'
```

--

&lt;br /&gt;

- Le fichier s'ouvre dans votre éditeur de texte et affiche :



```
## Package: pkgmin
## Title: What the Package Does (One Line, Title Case)
## Version: 0.0.0.9000
## Authors@R: 
##     person(given = "First",
##            family = "Last",
##            role = c("aut", "cre"),
##            email = "first.last@example.com",
##            comment = c(ORCID = "YOUR-ORCID-ID"))
## Description: What the package does (one paragraph).
## License: What license it uses
## Encoding: UTF-8
## LazyData: true
```



---

## Métadonnées du package

- Mettons à jour nos informations :


```
## Package: pkgmin
## Title: Structure d'un package simple sous R
## Version: 0.0.0.9000
## Authors@R:
##     person(
##         given  = "Nicolas",
##         family = "Casajus",
##         role   = c("aut", "cre"),
##         email  = "nicolas.casajus@fondationbiodiversite.fr"
##     )
## Description: Le package \code{pkgmin} illustre la structure d'un package...
## Depends: R (&gt;= 3.6.0)
## License: What license it uses
## Encoding: UTF-8
## LazyData: true
```

&lt;br /&gt;

<i class="fas  fa-hand-point-right "></i> &amp;nbsp;Par convention, la première version d'un
package en développement est habituellement notée : `0.0.0.9000`



---

## Choix d'une licence

- Définissons maintenant la licence du package qui imposera ses conditions d'utilisation.
Nous choisissons ici la licence [**MIT**](https://choosealicense.com/licenses/mit/),
très peu contraignante.


```r
usethis::use_mit_license(name = "Nicolas Casajus")
```


```
## ✔ Setting License field in DESCRIPTION to 'MIT + file LICENSE'
## ✔ Writing 'LICENSE.md'
## ✔ Adding '^LICENSE\\.md$' to '.Rbuildignore'
## ✔ Writing 'LICENSE'
```

--

&lt;br /&gt;


```r
dir(all.files = TRUE)
```


```
## [1] ".git"          ".gitignore"    ".Rbuildignore" "DESCRIPTION"  
## [5] "LICENSE"       "LICENSE.md"    "NAMESPACE"     "R"
```



---

## Choix d'une licence

- D'autres licences sont disponibles :


```r
?usethis::use_mit_license
```

&lt;br /&gt;

- Pour vous orienter dans votre choix :
[https://choosealicense.com](https://choosealicense.com)



---

## Mise en place de la documentation

- Ajoutons un cadre de travail `roxygen` pour documenter notre package.

- Le package `roxygen2` permet de :
  1. générer la documentation des fonctions (fichiers Rd dans `man/`)
  1. mettre à jour le `NAMESPACE`

--

&lt;br /&gt;


```r
usethis::use_roxygen_md()                                         # Init roxygen2
```


```
## ✔ Setting Roxygen field in DESCRIPTION to 'list(markdown = TRUE)'
## ✔ Setting RoxygenNote field in DESCRIPTION to '7.0.0'
## ● Run `devtools::document()`
```

--

&lt;br /&gt;


```r
usethis::use_package_doc()                                # Add pkg documentation
```


```
## ✔ Writing 'R/pkgmin-package.R'
```



---

## Mise en place de la documentation

- Générons la documentation du fichier `R/pkgmin-package.R`
(page d'accueil du package)


```r
devtools::document()                                  # ou roxygen2::roxygenize()
```


```
## Updating pkgmin documentation
```

```
## Writing NAMESPACE
```

```
## Loading pkgmin
```

```
## Writing pkgmin-package.Rd
```

--

&lt;br /&gt;


```r
list.files(recursive = TRUE)
```


```
## [1] "DESCRIPTION"           "LICENSE"               "LICENSE.md"           
## [4] "man/pkgmin-package.Rd" "NAMESPACE"             "R/pkgmin-package.R"
```



---

## Mise en place de la documentation

- Affichons le contenu du fichier `man/pkgmin-package.Rd`


```
## % Generated by roxygen2: do not edit by hand
## % Please edit documentation in R/pkgmin-package.R
## \docType{package}
## \name{pkgmin-package}
## \alias{pkgmin}
## \alias{pkgmin-package}
## \title{pkgmin: Structure d'un package simple sous R}
## \description{
## Le package \code{pkgmin} illustre la structure d'un package...
## }
## \author{
## \strong{Maintainer}: Nicolas Casajus \email{nicolas.casajus@fondationbiodiversite.fr}
## 
## }
## \keyword{internal}
```



---

## Développement d'une fonction R

- Créons notre fonction R : `moyenne()`


```r
usethis::use_r("moyenne")
```


```
## ● Edit 'R/moyenne.R'
```

--

&lt;br /&gt;


```r
list.files(recursive = TRUE)
```


```
## [1] "DESCRIPTION"           "LICENSE"               "LICENSE.md"           
## [4] "man/pkgmin-package.Rd" "NAMESPACE"             "R/moyenne.R"          
## [7] "R/pkgmin-package.R"
```

&lt;br /&gt;

- Le fichier a bien été créé dans le répertoire `R/`

- Nous allons maintenant implémenter le code de la fonction



---

## Développement d'une fonction R


```r
moyenne &lt;- function(x, na_rm = FALSE) {

  ## Checks                         ----------

  if (missing(x)) { stop("Missing x.") }
  if (!is.vector(x)) { stop("x must be a numeric vector.") }
  if (!is.numeric(x)) { stop("x must be a numeric vector.") }
  if (length(x) &lt; 2) { stop("x must be length &gt; 1.") }
  if (!is.logical(na_rm)) { stop("na_rm must be TRUE or FALSE.") }

  ## Remove NAs (if required)       ----------

  if (na_rm) {

    x &lt;- x %&gt;% na.omit()

    if (length(x) &lt; 2) { stop("x has &lt; 2 non-NA values.") }

  } else {

    if (sum(is.na(x)) &gt; 0) { stop("x contains NA values. Use na_rm = TRUE.") }
  }


  ## Compute mean                   ----------

  sum(x) / length(x)
}
```





---

## Développement d'une fonction R

- Vérifions qu'elle fonctionne correctement


```r
library("magrittr")
devtools::load_all()                            # Source le contenu du dossier R/
```




```r
moyenne(x = c(2, 4))
```

```
## [1] 3
```


```r
moyenne(x = c(2, 4, NA))
```

```
## Error in moyenne(x) : x contains NA values. Use na_rm = TRUE.
```


```r
moyenne(x = c(2, 4, NA), na_rm = TRUE)
```

```
## [1] 3
```

&lt;br /&gt;

<i class="fas  fa-hand-point-right "></i> &amp;nbsp;Pour l'instant, nous devons importer explicitement
le package `{magrittr}` pour pouvoir utiliser notre fonction. Nous verrons par la
suite comment contourner ceci (notamment avec le `NAMESPACE`)



---

## Documentation de la fonction

- Une fonction n'est rien sans son mode d'emploi.
Documentons alors notre fonction avec les tags `roxygen`.

--


```r
#' @title Moyenne d'un vecteur numerique
#' @description Cette fonction calcule la moyenne d'un vecteur numerique en
#'   omettant les valeurs manquantes si l'utilisateur le souhaite.
#'
#' @param x Un vecteur numerique sur lequel sera calculer la moyenne
#' @param na_rm Si TRUE supprime les NA (Defaut : FALSE)
#'
#' @return La fonction renvoie la moyenne du vecteur x.
#'
#' @import magrittr
#' @importFrom stats na.omit
#'
#' @export
#'
#' @examples
#' moyenne(c(2, 4))
#'

moyenne &lt;- function(x, na_rm = FALSE) {...}
```



---

## Documentation de la fonction

- Chaque ligne de l'entête `roxygen` commence par `#'` suivi d'un espace.

- Un tag `roxygen` est un mot-clé précédé du symbole `@`. Voici les principaux :

  - `@title` : titre court de la fonction
  - `@description` : description de la fonction (plusieurs lignes)
  - `@param x` : description du paramètre `x`
  - `@return` : l'objet que renvoie la fonction (facultatif si pas de renvoi)
  - `@examples` : un exemple reproductible

--

&lt;br /&gt;

- A ceux-ci s'ajoutent trois autres tags :

  - `@export` : indique que la fonction sera visible et accessible
  - `@import` : indique les packages à importer
  - `@importFrom` : indique les fonctions des dépendances à importer



---

## Compilation de la documentation

- Générons maintenant le fichier `Rd` de la fonction `moyenne()`


```r
devtools::document()                                  # ou roxygen2::roxygenize()
```


```
## Updating pkgmin documentation
```

```
## Writing NAMESPACE
```

```
## Loading pkgmin
```

```
## Writing NAMESPACE
## Writing moyenne.Rd
```

--

&lt;br /&gt;


```r
list.files(recursive = TRUE)
```


```
## [1] "DESCRIPTION"           "LICENSE"               "LICENSE.md"           
## [4] "man/moyenne.Rd"        "man/pkgmin-package.Rd" "NAMESPACE"            
## [7] "R/moyenne.R"           "R/pkgmin-package.R"
```



---

## Compilation de la documentation

- Affichons la documentation de la fonction `moyenne()`


```
## % Generated by roxygen2: do not edit by hand
## % Please edit documentation in R/moyenne.R
## \name{moyenne}
## \alias{moyenne}
## \title{Moyenne d'un vecteur numerique}
## \usage{
## moyenne(x, na_rm = FALSE)
## }
## \arguments{
## \item{x}{Un vecteur numerique sur lequel sera calculer la moyenne}
## 
## \item{na_rm}{Si TRUE supprime les NA (Defaut : FALSE)}
## }
## \value{
## La fonction renvoie la moyenne du vecteur x.
## }
## \description{
## Cette fonction calcule la moyenne d'un vecteur numerique en
## omettant les valeurs manquantes si l'utilisateur le souhaite.
## }
## \examples{
## moyenne(c(2, 4))
## 
## }
```



---

## NAMESPACE et DESCRIPTION

- Le `NAMESPACE` a également été mis à jour


```
## # Generated by roxygen2: do not edit by hand
## 
## export(moyenne)
## import(magrittr)
## importFrom(stats,na.omit)
```



---

## NAMESPACE et DESCRIPTION

- Mais, pas le fichier `DESCRIPTION`


```
## Package: pkgmin
## Title: Structure d'un package simple sous R
## Version: 0.0.0.9000
## Authors@R:
##     person(
##         given  = "Nicolas",
##         family = "Casajus",
##         role   = c("aut", "cre"),
##         email  = "nicolas.casajus@fondationbiodiversite.fr"
##     )
## Description: Le package \code{pkgmin} illustre la structure d'un package...
## Depends: R (&gt;= 3.6.0)
## License: MIT + file LICENSE
## Encoding: UTF-8
## LazyData: true
## Roxygen: list(markdown = TRUE)
## RoxygenNote: 7.0.0
```



---

## NAMESPACE et DESCRIPTION

- Mettons à jour les dépendances dans le fichier `DESCRIPTION`


```r
usethis::use_package(package = "magrittr")
usethis::use_package(package = "stats")
```


```
## ✔ Adding 'magrittr' to Imports field in DESCRIPTION
## ● Refer to functions with `magrittr::fun()`
```

```
## ✔ Adding 'stats' to Imports field in DESCRIPTION
## ● Refer to functions with `stats::fun()`
```



---

## NAMESPACE et DESCRIPTION

- Affichons le contenu du fichier `DESCRIPTION`


```
## Package: pkgmin
## Title: Structure d'un package simple sous R
## Version: 0.0.0.9000
## Authors@R:
##     person(
##         given  = "Nicolas",
##         family = "Casajus",
##         role   = c("aut", "cre"),
##         email  = "nicolas.casajus@fondationbiodiversite.fr"
##     )
## Description: Le package \code{pkgmin} illustre la structure d'un package...
## Depends: R (&gt;= 3.6.0)
## License: MIT + file LICENSE
## Encoding: UTF-8
## LazyData: true
## Roxygen: list(markdown = TRUE)
## RoxygenNote: 7.0.0
## Imports: 
##     magrittr,
##     stats
```



---

## Exemple reproductible

.pull-leftt[
.center[![:scale 50%](assets/img/hex-reprex.png)]
]

.pull-rightt[
- Il est fortement recommendé d'ajouter un jeu de données au package (section `@examples`)

- Ceci rendra le package plus reproductible (_reproductible example_)
]

&lt;br /&gt;

--

Deux options se présenteront :

1. Données internes : format `Rdata`, `rda` ou `rds`
1. Données brutes : autre format (`txt`, `csv`, `tsv`, etc.)



---

## Exemple reproductible

- Données internes (`rda`)
  - Celles-ci seront stockées dans le répertoire `data/`
  - La fonction `usethis::use_data()` facilite leur création
  - Elles seront accessibles, une fois le package installé, avec `data()`

--

&lt;br /&gt;

- Données brutes (`csv` par ex.)
  - Elles devront être stockées dans le répertoire `inst/data-raw/`
  - La fonction `usethis::use_data_raw()` facilite leur création
  - Elles seront accessibles, une fois le package installé, avec la fonction


```r
system.file("data-raw", "filename.csv", package = "pkgmin")
```

&lt;br /&gt;

<i class="fas  fa-hand-point-right "></i> &amp;nbsp;Le nom du répertoire `inst/` est
obligatoire, mais le nom du sous-répertoire (`data-raw`) n'a pas d'importance,
même si la fonction `usethis::use_data_raw()` ne propose pas de changer son nom.



---

## Exemple reproductible

- Créons un jeu de données fictif


```r
set.seed(1637)
(x  &lt;- rnorm(9))
```

```
## [1] -0.36408688 -0.49095886 -1.23603718 -0.76769157 -0.60156359 -2.48098410
## [7] -0.60094632 -0.21617985 -0.07851793
```

```r
(y  &lt;- c(NA, 2:9))
```

```
## [1] NA  2  3  4  5  6  7  8  9
```

```r
(xy &lt;- data.frame(x, y))
```

```
##             x  y
## 1 -0.36408688 NA
## 2 -0.49095886  2
## 3 -1.23603718  3
## 4 -0.76769157  4
## 5 -0.60156359  5
## 6 -2.48098410  6
## 7 -0.60094632  7
## 8 -0.21617985  8
## 9 -0.07851793  9
```



---

## Exemple reproductible

- Convertissons-le en `rda`


```r
usethis::use_data(xy, internal = FALSE)
```


```
## ✔ Creating 'data/'
## ✔ Saving 'xy' to 'data/xy.rda'
```


<i class="fas  fa-hand-point-right "></i> &amp;nbsp;Dans le cas d'un exemple reproductible,
on veut que l'utilisateur puisse avoir accès aux données. On indiquera donc
`internal = FALSE`.

--

&lt;br /&gt;


```r
list.files(recursive = TRUE)
```


```
## [1] "data/xy.rda"           "DESCRIPTION"           "LICENSE"              
## [4] "LICENSE.md"            "man/moyenne.Rd"        "man/pkgmin-package.Rd"
## [7] "NAMESPACE"             "R/moyenne.R"           "R/pkgmin-package.R"
```



---

## Documentation des données

- Tout comme pour les fonctions, les données internes doivent être documentées
- Il convient de créer dans le répertoire `R/` un fichier R qui portera le même
nom que le fichier `rda`
- Il contiendra l'entête `roxygen` et le nom du jeu de données

--


- Créons le fichier R


```r
usethis::use_r("xy")
```


```
## ● Edit 'R/xy.R'
```

--

&lt;br /&gt;


```r
list.files(recursive = TRUE)
```


```
##  [1] "data/xy.rda"           "DESCRIPTION"           "LICENSE"              
##  [4] "LICENSE.md"            "man/moyenne.Rd"        "man/pkgmin-package.Rd"
##  [7] "NAMESPACE"             "R/moyenne.R"           "R/pkgmin-package.R"   
## [10] "R/xy.R"
```



---

## Documentation des données

- Voici l'entête `roxygen` spécifique d'un jeu de données


```r
#' @title Exemple d'un jeu de donnees interne
#' @description Un jeu de donnees fictif illustrant la construction d'un
#' exemple reproductible interne
#'
#' @format Un data frame avec 9 lignes et 2 colonnes :
#' \describe{
#'   \item{x}{valeurs tirees aleatoirement dans une distribution normale}
#'   \item{y}{sequences de 2 a 9 avec une valeur manquante}
#' }
#' @source Random Number Generator (RNG): 1637
#'

"xy"
```



---

## Utilisation de l'exemple reproductible

- Modifions l'exemple reproductible de notre fonction `moyenne()` de manière à
utiliser ce jeu de données

--


```r
#' @title Moyenne d'un vecteur numerique
#' @description Cette fonction calcule la moyenne d'un vecteur numerique en
#'   omettant les valeurs manquantes si l'utilisateur le souhaite.
#'
#' @param x Un vecteur numerique sur lequel sera calculer la moyenne
#' @param na_rm Si TRUE supprime les NA (Defaut : FALSE)
#'
#' @return La fonction renvoie la moyenne du vecteur x.
#'
#' @import magrittr
#' @importFrom stats na.omit
#'
#' @export
#'
#' @examples
#' data(xy)
#' moyenne(xy$x)
#' moyenne(xy[ , "y"], na_rm = TRUE)
#'

moyenne &lt;- function(x, na_rm = FALSE) {...}
```




---

## Compilation de la documentation

- Générons maintenant le fichier `Rd` du jeu de données `xy.rda`


```r
devtools::document()                                  # ou roxygen2::roxygenize()
```


```
## Updating pkgmin documentation
```

```
## Writing NAMESPACE
```

```
## Loading pkgmin
```

```
## Writing NAMESPACE
## Writing moyenne.Rd
## Writing xy.Rd
```

--

<i class="fas  fa-hand-point-right "></i> &amp;nbsp;La documentation de la fonction `moyenne()`
a également été mise à jour (puisque nous avons modifié l'exemple `roxygen`)



```r
list.files(recursive = TRUE)
```


```
##  [1] "data/xy.rda"           "DESCRIPTION"           "LICENSE"              
##  [4] "LICENSE.md"            "man/moyenne.Rd"        "man/pkgmin-package.Rd"
##  [7] "man/xy.Rd"             "NAMESPACE"             "R/moyenne.R"          
## [10] "R/pkgmin-package.R"    "R/xy.R"
```



---

## Compilation de la documentation

- Affichons le contenu du fichier `man/xy.Rd`


```
## % Generated by roxygen2: do not edit by hand
## % Please edit documentation in R/xy.R
## \docType{data}
## \name{xy}
## \alias{xy}
## \title{Exemple d'un jeu de donnees interne}
## \format{Un data frame avec 9 lignes et 2 colonnes :
## \describe{
## \item{x}{valeurs tirees aleatoirement dans une distribution normale}
## \item{y}{sequences de 2 a 9 avec une valeur manquante}
## }}
## \source{
## Random Number Generator (RNG): 1637
## }
## \usage{
## xy
## }
## \description{
## Un jeu de donnees fictif illustrant la construction d'un
## exemple reproductible interne
## }
## \keyword{datasets}
```



---

## Où en sommes-nous ?

.center[![:scale 80%](assets/img/screen-pkg.png)]

&lt;br /&gt;

Le développement de notre package est maintenant terminé. Vérifions sa structure et son intégrité



---

## Vérification du package



```r
devtools::check()
```

```
── R CMD check ────────────────────────────────────────────────────────────────────
✔  checking DESCRIPTION meta-information ...
✔  checking R code for possible problems (1.6s)
✔  checking Rd files ...
✔  checking Rd metadata ...
✔  checking Rd cross-references ...
✔  checking for missing documentation entries ...
✔  checking for code/documentation mismatches (353ms)
✔  checking Rd \usage sections (572ms)
✔  checking Rd contents ...
✔  checking contents of ‘data’ directory ...
✔  checking data for non-ASCII characters ...
✔  checking data for ASCII and uncompressed saves ...
✔  checking examples (476ms)

── R CMD check results ────────────────────────────────── pkgmin 0.0.0.9000 ───────
Duration: 9.8s

0 errors ✔ | 0 warnings ✔ | 0 notes ✔
```

- Notre package ne comporte aucune erreur
&amp;nbsp;<i class="fas  fa-beer "></i>
&amp;nbsp;<i class="fas  fa-beer "></i>
&amp;nbsp;<i class="fas  fa-beer "></i>



---

## Changement de version

- Notre package est vérifié et a passé avec succès tous les tests

- Nous pouvons changer sa version


```r
usethis::use_version(which = "major")
```


```
## ✔ Setting Version field in DESCRIPTION to '1.0.0'
```



---

## Installation du package

- Puisque notre package est vérifié, nous pouvons maintenant l'installer dans notre librairie R


```r
devtools::install()
```

```
* installing *source* package ‘pkgmin’ ...
** using staged installation
** R
** byte-compile and prepare package for lazy loading
** help
*** installing help indices
** building package indices
** testing if installed package can be loaded from temporary location
** testing if installed package can be loaded from final location
** testing if installed package keeps a record of temporary installation path
* DONE (pkgmin)
```

--

&lt;br /&gt;


```r
library("pkgmin")
```

- Le tour est joué !


---

## Utilisation du package


```r
?pkgmin
```

```
pkgmin-package              package:pkgmin               R Documentation

pkgmin: Structure d'un package simple sous R

Description:
    Le package ‘pkgmin’ illustre la structure d'un package...

Author(s):
    *Maintainer*: Nicolas Casajus &lt;email: nicolas.casajus@fondationbiodiversite.fr&gt;
```

--

&lt;br /&gt;


```r
ls("package:pkgmin")                                         # Contenu du package
```

```
## [1] "moyenne" "xy"
```



---

## Utilisation du package


```r
?pkgmin::moyenne
```

```
moyenne                 package:pkgmin                  R Documentation

Moyenne d'un vecteur numerique

Description:
    Cette fonction calcule la moyenne d'un vecteur numerique en
    omettant les valeurs manquantes si l'utilisateur le souhaite.

Usage:
    moyenne(x, na_rm = FALSE)

Arguments:
       x: Un vecteur numerique sur lequel sera calculer la moyenne
   na_rm: Si TRUE supprime les NA (Defaut : FALSE)

Value:
    La fonction renvoie la moyenne du vecteur x.

Examples:
    data(xy)
    moyenne(xy$x)
    moyenne(xy[ , "y"], na_rm = TRUE)
```



---

## Utilisation du package


```r
data(xy)
head(xy, 3)
```

```
##             x  y
## 1 -0.36408688 NA
## 2 -0.49095886  2
## 3 -1.23603718  3
```


```r
moyenne(xy)
```

```
## Error in moyenne(xy) : x must be a numeric vector.
```


```r
moyenne(xy$y)
```

```
## Error in moyenne(xy$y) : x contains NA values. Use na_rm = TRUE.
```


```r
moyenne(xy$y, na_rm = TRUE)
```

```
## [1] 5.5
```



---

## Utilisation du package


```r
x   &lt;- rnorm(100)
moy &lt;- pkgmin::moyenne(x)

boxplot(x, col = "#49847b", border = "#7c4e20", horizontal = TRUE)
points(y = 1, x = moy, pch = 17, cex = 2, col = "red")
```

![](assets/chunks/boxplot-1.png)&lt;!-- --&gt;



---
.pull-left[
## En résumé
]

.pull-right[
.bottom[
.right[
  ![:scale 15%](assets/img/hex-devtools.png)
  &amp;nbsp;&amp;nbsp;&amp;nbsp;
  ![:scale 15%](assets/img/hex-usethis.png)
  &amp;nbsp;&amp;nbsp;&amp;nbsp;
  ![:scale 15%](assets/img/hex-roxygen2.png)
]]]


```r
usethis::create_package("path/to/package")      # Package skeleton
usethis::use_git()                              # Init git repository
usethis::use_roxygen_md()                       # Init roxygen2

usethis::edit_file("DESCRIPTION")               # Edit package metadata
usethis::use_mit_license("author")              # Add a license

usethis::use_package_doc()                      # Add pkg documentation
devtools::document()                            # Generate pkg documentation

usethis::use_r("function")                      # Edit new function + doc
devtools::load_all()                            # Source R/ content
devtools::document()                            # Generate function doc

usethis::use_package("dependencies")            # Add dependencies in DESCRIPTION

usethis::use_data(data)                         # Create internal data
usethis::use_r("dataset")                       # Edit data documentation
devtools::document()                            # Update functions/data doc

devtools::check()                               # Check package building

usethis::use_version("major")                   # Update major version

devtools::install()                             # Install package locally
library("package")                              # Load package
```

---
class: inverse, center, middle

## Utilisation avancée

&lt;br /&gt;

.center[
  ![:scale 15%](assets/img/hex-rmarkdown.png)
  &amp;nbsp;&amp;nbsp;&amp;nbsp;
  ![:scale 15%](assets/img/hex-pkgdown.png)
  &amp;nbsp;&amp;nbsp;&amp;nbsp;
  ![:scale 15%](assets/img/hex-testthat.png)

  ![:scale 15%](assets/img/travis-ci.png)
  &amp;nbsp;&amp;nbsp;&amp;nbsp;
  ![:scale 15%](assets/img/appveyor.png)
  &amp;nbsp;&amp;nbsp;&amp;nbsp;
  ![:scale 15%](assets/img/codecover.png)
]

---


## Création d'une vignette


.pull-leftt[
.center[[![:scale 50%](assets/img/hex-rmarkdown.png)](https://rmarkdown.rstudio.com)]
]

.pull-rightt[
- Une [**vignette**](http://r-pkgs.had.co.nz/vignettes.html) est un guide du package
- C'est un complément aux documentations des fonctions
- Cela peut également être une analyse complète reposant sur ce package
]

--

&lt;br /&gt;

De nombreux packages proposent des vignettes


```r
browseVignettes()                                   # Pour les packages installés
```

.center[![:scale 100%](assets/img/vignettes.png)]



---

## Création d'une vignette

- Créons une vignette pour notre package


```r
usethis::use_vignette("pkgmin")
```


```
## ✔ Adding 'knitr' to Suggests field in DESCRIPTION
## ✔ Setting VignetteBuilder field in DESCRIPTION to 'knitr'
## ✔ Adding 'inst/doc' to '.gitignore'
## ✔ Creating 'vignettes/'
## ✔ Adding '*.html', '*.R' to 'vignettes/.gitignore'
## ✔ Adding 'rmarkdown' to Suggests field in DESCRIPTION
## ✔ Writing 'vignettes/pkgmin.Rmd'
## ● Edit 'vignettes/pkgmin.Rmd'
```

--


```r
list.files(recursive = TRUE)
```


```
##  [1] "data/xy.rda"           "DESCRIPTION"           "LICENSE"              
##  [4] "LICENSE.md"            "man/moyenne.Rd"        "man/pkgmin-package.Rd"
##  [7] "man/xy.Rd"             "NAMESPACE"             "R/moyenne.R"          
## [10] "R/pkgmin-package.R"    "R/xy.R"                "vignettes/pkgmin.Rmd"
```

--

<i class="fas  fa-hand-point-right "></i> &amp;nbsp;Il peut arriver qu'après une installation
du package depuis GitHub, la vignette soit absente. Dans ce cas-là, il faudra
enlever le dossier `inst/doc/` du `.gitignore`.

---

## Création d'une vignette

- La vignette est préconfigurée avec un YAML


```r
---
title: "pkgmin"
output: rmarkdown::html_vignette
vignette: &gt;
  %\VignetteIndexEntry{pkgmin}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```

- Il ne reste plus qu'à l'éditer...

--

&lt;br /&gt;

<i class="fas  fa-hand-point-right "></i> &amp;nbsp;Lors de l'installation du package avec
`{devtools}`, il faudra spécifier explicitement la construction de la vignette au
format HTML


```r
devtools::install_github(..., build_vignettes = TRUE)
```



---

## Déploiement sur GitHub

.pull-leftt[
.center[![:scale 75%](assets/img/github.png)]
]

.pull-rightt[
- Le package `{usethis}` est une véritable boîte à outils : il permet notamment
de créer un dépôt distant sur GitHub et de l'associer au dépôt local
- Deux prérequis :
  1. Le dépôt local doit être versionné et à jour
  2. Vous devez avoir un [**Token GitHub**](https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line)
]

--

&lt;br /&gt;

Commençons par obtenir un token ou PAT (_GitHub Personal Access Token_) pour utiliser GitHub en ligne de commande
(ici avec <i class="fab  fa-r-project "></i>)


```r
usethis::browse_github_token()
```



---

## Déploiement sur GitHub

Une fois, le GitHub PAT généré, il est courant de le stocker comme variable
d'environnement dans le fichier `.Renviron`

--

- Ouvrons le fichier `.Renviron` avec la commande


```r
usethis::edit_r_environ()
```

- Et ajoutons cette ligne (en adaptant la valeur)


```r
GITHUB_PAT=999999zzz99zz9z9zzzz9zzz99999z9z9z9zzz99
```

--

- Vérifions que le PAT est bien stocké (après un redémarrage de <i class="fab  fa-r-project "></i>)


```r
usethis::github_token()                             # ou Sys.getenv("GITHUB_PAT")
```

```
## [1] "9bb4facb6d23f48efbf424bb05c0c1ef1cf6f468393bc745d42179ac4aca5fee"
```

--

Ces étapes ne sont à faire qu'une seule fois

<i class="fas  fa-hand-point-right "></i> &amp;nbsp;Ressource sur la gestion des clés/tokens : [**Managing secrets**](https://cran.r-project.org/web/packages/httr/vignettes/secrets.html)



---

## Déploiement sur GitHub

- Avant de déployer notre package sur GitHub, nous pouvons ajouter un `README`
qui sera la page d'accueil de notre dépôt GitHub.




```r
usethis::use_readme_rmd()
```

--

- Il ne reste plus qu'à l'éditer, puis à compiler la version `markdown` du fichier
(nécessaire à chaque modification du `Rmd`)


```r
rmarkdown::render("README.Rmd")
```

```
## processing file: README.Rmd
## Preview created: README.html
## Output created: README.md
```

--

&lt;br /&gt;

- Nous pouvons enfin indiquer à `git` de ne pas suivre l'aperçu `html`


```r
usethis::use_git_ignore("README.html")
```



---

## Déploiement sur GitHub

- Après avoir mis à jour le dépôt `git` local (`git add` + `git commit`), nous pouvons
déployer notre dépôt local sur GitHub


```r
usethis::use_github(protocol = "https")          # Crée un dépôt sur votre compte

usethis::use_github(
  protocol     = "https",
  organisation = "org_name"               # Crée un dépôt dans votre organisation
)
```

<i class="fas  fa-hand-point-right "></i> &amp;nbsp;Si vous avez généré des clés de chiffrement
et déposé la clé publique sur GitHub, vous pouvez opter pour le protocole `ssh` plus sécurisé

--

&lt;br /&gt;

<i class="fas  fa-lightbulb " style="color:#3f3f3f;"></i> &amp;nbsp; Pour utiliser les commandes <i class="fab  fa-git "></i> directement sous <i class="fab  fa-r-project "></i>, nous pouvons utiliser la fonction `system()`


```r
system("git add -A")
system("git commit -m 'Commit message'")
```



---

## Déploiement sur GitHub

Et voilà, le package est en ligne : [**https://github.com/ahasverus/pkgmin**](https://github.com/ahasverus/pkgmin)

.center[![:scale 80%](assets/img/pkgmin-github.png)]



---

## Déploiement sur GitHub

Si le versioning a été correctement fait, n'importe qui peut voir les différentes étapes du développement du package

.center[![:scale 80%](assets/img/git-history.png)]

Résultat obtenu avec la commande : `git log --oneline`

Accessible aussi à : [https://github.com/ahasverus/pkgmin/commits/master](https://github.com/ahasverus/pkgmin/commits/master)



---

## Intégration continue - Travis CI

.pull-leftt[
  .center[[![:scale 75%](assets/img/travis-ci.png)](https://travis-ci.org)]
]

.pull-rightt[
- [**Travis CI**](https://travis-ci.org) est un service d'intégration continue
- Exécute automatiquement le code d'un dépôt GitHub après chaque _push_
- Serveur GNU/Linux (Ubuntu)
- Son fichier de configuration est écrit en YAML

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;![:scale 20%](https://travis-ci.org/ahasverus/pkgmin.svg?branch=master)
]

--

&lt;br /&gt;

Après vous être enregistré sur [**Travis CI**](https://travis-ci.org) avec vos
identifiants GitHub, nous pouvons configurer le dépôt GitHub pour qu'il communique
avec ce service d'intégration continue


```r
usethis::use_travis()
```

```
✔ Writing '.travis.yml'
✔ Adding '^\\.travis\\.yml$' to '.Rbuildignore'
● Turn on travis for your repo at https://travis-ci.org/profile/ahasverus
✔ Adding Travis build status badge to 'README.Rmd'
● Re-knit 'README.Rmd'
```



---

## Intégration continue - Travis CI

- Dans les paramètres de votre compte Travis CI, vous devez activer le dépôt `{pkgmin}` pour que l'intégration soit effective

.center[![:scale 60%](assets/img/travis-setup.png)]

--

&lt;br /&gt;

- Plusieurs choses se sont passées après l'exécution de la commande `usethis::use_travis()`

  - Le fichier de configuration de Travis CI (`.travis.yml`) a été ajouté
  - Le badge de statut Travis du dépôt a été ajouté au `README.Rmd`

--

&lt;br /&gt;

- Avant d'oublier, recompilons le `README.Rmd` en `README.md`


```r
rmarkdown::render("README.Rmd")
```



---

## Intégration continue - Travis CI

- Modifions le fichier de configuration `.travis.yml`

```
  language: r
  warnings_are_errors: false
  sudo: required
  cache: packages

  notifications:
    email:
      recipients:
        - nicolas.casajus@fondationbiodiversite.fr

  r_packages:
    - magrittr
```

--

&lt;br /&gt;

- Nous sommes prêt :


```r
system("git add -A")
system("git commit -m 'Setup Travis CI'")
system("git push")
```



---

## Intégration continue - Travis CI

.center[![:scale 80%](assets/img/travis-badge1.png)]

.center[![:scale 80%](assets/img/travis-build1.png)]



---

## Intégration continue - Travis CI

Côté Travis CI, un code de sortie 0 est bon signe,

.center[![:scale 80%](assets/img/travis-log.png)]

&lt;br /&gt;

ce qui nous permet d'obtenir notre premier badge

.center[![:scale 20%](https://travis-ci.org/ahasverus/pkgmin.svg?branch=master)]



---

## Intégration continue - Travis CI

.center[![:scale 80%](assets/img/travis-badge2.png)]

.center[![:scale 80%](assets/img/travis-build2.png)]


---

## Intégration continue - Appveyor

.pull-leftt[
.center[[![:scale 75%](assets/img/appveyor.png)](https://www.appveyor.com)]
]

.pull-rightt[
- Similaire à Travis CI
- Service d'intégration continue
- Serveur déployé sous Windows
- Son fichier de configuration est aussi écrit en YAML

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;![:scale 20%](https://ci.appveyor.com/api/projects/status/github/ahasverus/pkgmin?branch=master&amp;svg=true)
]

--

&lt;br /&gt;

Après vous être enregistré sur [**appveyor**](https://www.appveyor.com) avec vos
identifiants GitHub, nous pouvons configurer le dépôt GitHub pour qu'il communique
avec ce service d'intégration continue


```r
usethis::use_appveyor()
```

```
✔ Writing 'appveyor.yml'
✔ Adding '^appveyor\\.yml$' to '.Rbuildignore'
● Turn on AppVeyor for this repo at https://ci.appveyor.com/projects/new
✔ Adding AppVeyor build status badge to 'README.Rmd'
● Re-knit 'README.Rmd'
```



---

## Intégration continue - Appveyor

- Dans les paramètres de votre compte Appveyor, vous devez activer le dépôt `{pkgmin}` pour que l'intégration soit effective

.center[![:scale 60%](assets/img/appveyor-setup.png)]

--

&lt;br /&gt;

- Plusieurs choses se sont passées après l'exécution de la commande `usethis::use_appveyor()`

  - Le fichier de configuration de Appveyor (`appveyor.yml`) a été ajouté
  - Le badge de statut Appveyor du dépôt a été ajouté au `README.Rmd`

--

&lt;br /&gt;

- Avant d'oublier, recompilons le `README.Rmd` en `README.md`


```r
rmarkdown::render("README.Rmd")
```



---

## Intégration continue - Appveyor

- Le fichier de configurartion d'Appveyor se base sur celui de Travis CI, donc pas besoin de le modifier

- Nous sommes prêt à tester l'intégration :


```r
system("git add -A")
system("git commit -m 'Setup Appveyor'")
system("git push")
```



---

## Intégration continue - Appveyor

.center[![:scale 80%](assets/img/appveyor-badge.png)]

.center[![:scale 80%](assets/img/appveyor-build.png)]

.center[![:scale 20%](https://ci.appveyor.com/api/projects/status/github/ahasverus/pkgmin?branch=master&amp;svg=true)]

---

## Création d'un site web

.pull-leftt[
.center[[![:scale 75%](assets/img/hex-pkgdown.png)](https://pkgdown.r-lib.org)]
]

.pull-rightt[
- Pourquoi ne pas créer un site web pour votre package ?
- Le package `{pkgdown}` permet de faire ça très simplement
- Le site comprendra le README, les pages des fonctions/objets ainsi que la vignette
]

--

&lt;br /&gt;

- Initialisation de `{pkgdown}` pour notre package


```r
usethis::use_pkgdown()
```

```
✔ Adding '^_pkgdown\\.yml$', '^docs$' to '.Rbuildignore'
✔ Adding '^pkgdown$' to '.Rbuildignore'
✔ Writing '_pkgdown.yml'
● Modify '_pkgdown.yml'
```



---

## Création d'un site web

- Construisons notre site web


```r
pkgdown::build_site()
```

```
══ Building pkgdown site ══════════════════════════════════════════════════════════
Writing to:   '/Users/nicolascasajus/Desktop/pkgmin/docs'
── Initialising site ──────────────────────────────────────────────────────────────
Writing 'authors.html'
Writing 'LICENSE.html'
Writing 'index.html'
── Building home ──────────────────────────────────────────────────────────────────
Writing 'authors.html'
Writing 'LICENSE.html'
Writing 'index.html'
Writing 'reference/index.html'
Writing 'reference/moyenne.html'
Writing 'reference/pkgmin-package.html'
Writing 'reference/xy.html'
── Building articles ──────────────────────────────────────────────────────────────
Writing 'articles/index.html'
Writing 'articles/pkgmin.html'
══ DONE ═══════════════════════════════════════════════════════════════════════════
```

--

<i class="fas  fa-hand-point-right "></i> &amp;nbsp;[**https://ahasverus.github.io/pkgmin**](https://ahasverus.github.io/pkgmin)



---

## Création d'un site web

- Une seule contrainte cependant : à chaque modification de notre package, nous
devrons reconstruire notre site manuellement avec `pkgdown::build_site()` (avec
le risque d'oublier)

--

- Pourquoi ne pas utiliser Travis CI pour déployer notre site web à notre place
après chaque _push_ ?

--

- Avant toute chose, nous devons installer un package supplémentaire :


```r
remotes::install_github("ropenscilabs/travis")
```

ou


```r
devtools::install_github("ropenscilabs/travis")
```

- Le package `{travis}` nous permettra d'autoriser Travis CI à écrire sur notre dépôt GitHub

<i class="fas  fa-hand-point-right "></i> &amp;nbsp;Il est très permissif, donc à vous de voir
si vous souhaitez l'utiliser ou pas (dans ce cas-là vous devrez ajouter le GitHub
PAT dans les variables d'environnement de Travis CI pour chaque dépôt)



---

## Création d'un site web

- Initialisons la connexion Travis CI-`{pkgdown}`


```r
usethis::use_pkgdown_travis()
```

```
✔ Adding 'docs/' to '.gitignore'
● Set up deploy keys by running `travis::use_travis_deploy()`
● Insert the following code in '.travis.yml'
 before_cache: Rscript -e 'remotes::install_cran("pkgdown")'
 deploy:
   provider: script
   script: Rscript -e 'pkgdown::deploy_site_github()'
   skip_cleanup: true
```

--

- Et donnons les autorisations nécessaires à Travis CI :


```r
travis::use_travis_deploy()
```

```
✔ Authentication successful.
✔ Successfully added public deploy key travis+tic' to GitHub for ahasverus/pkgmin.
✔ Successfully added private deploy key to ahasverus/pkgmin as secure environment
  variable id_rsa to Travis CI.
```



---

## Création d'un site web

- Modifions le `.travis.yml` comme suit :

```
  language: r
  warnings_are_errors: false
  sudo: required
  cache: packages

  notifications:
    email:
      recipients:
        - nicolas.casajus@fondationbiodiversite.fr

  r_packages:
    - magrittr

  before_cache: Rscript -e 'remotes::install_cran("pkgdown")'
  deploy:
    provider: script
    script: Rscript -e 'pkgdown::deploy_site_github()'
    skip_cleanup: true
```

--

<i class="fas  fa-hand-point-right "></i> &amp;nbsp;Et voilà ! Après chaque push, notre site web sera reconstruit automatiquement !!!



---

## Tests unitaires

.pull-leftt[
.center[[![:scale 75%](assets/img/hex-testthat.png)](https://testthat.r-lib.org)]
]

.pull-rightt[
- Tester son code est une partie importante du développement logiciel
- Les tests unitaires permettent de s'assurer que notre code fonctionne comme il le devrait
- `{testthat}` implémente de nombreux tests unitaires
]

--


```r
usethis::use_testthat()
```

```
✔ Adding 'testthat' to Suggests field in DESCRIPTION
✔ Creating 'tests/testthat/'
✔ Writing 'tests/testthat.R'
● Call `use_test()` to initialize a basic test file and open it for editing.
```

--

Le fichier `tests/testthat.R` contient les outils nécessaires pour les tests


```r
library(testthat)
library(pkgmin)

test_check("pkgmin")
```


---

## Tests unitaires

- Créons maintenant un fichier de tests pour la fonction : `moyenne()`


```r
usethis::use_test("moyenne")
```

```
✔ Increasing 'testthat' version to '&gt;= 2.1.0' in DESCRIPTION
✔ Writing 'tests/testthat/test-moyenne.R'
● Modify 'tests/testthat/test-moyenne.R'
```


---

## Tests unitaires

- Remplaçons le contenu de `tests/testthat/test-moyenne.R` par quelques tests :

```r
context("Tests for moyenne()")

data(xy)

test_that("check inputs", {

  expect_error(moyenne(xy$y),     "x contains NA values. Use na_rm = TRUE.")
  expect_error(moyenne(c(2, NA), na_rm = TRUE),  "x has &lt; 2 non-NA values.")
})

test_that("check outputs", {

  expect_length(moyenne(xy$x), 1)

  expect_equal(moyenne(xy$x), -0.7596629, tolerance = 1e-1)
  expect_equal(moyenne(xy$y, na_rm = TRUE), 5.5, tolerance = 1e-1)
})
```

--

Si notre fonction est bien implémentée, aucun message ne sera affiché

<i class="fas  fa-hand-point-right "></i> &amp;nbsp;Lors de la construction du package (sous Travis CI notamment), ces tests sont pris en compte



---

## Code coverage

.pull-leftt[
.center[[![:scale 75%](assets/img/codecover.png)](https://codecov.io)]
]

.pull-rightt[
- La couverture du code représente le pourcentage des lignes de code qui sont couvertes par les tests unitaires
- Utilise donc les tests `{testthat}`

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;![:scale 20%](https://codecov.io/gh/ahasverus/pkgmin/branch/master/graph/badge.svg)
]

--

&lt;br /&gt;


```r
usethis::use_coverage("codecov")
```

```
✔ Adding 'covr' to Suggests field in DESCRIPTION
✔ Writing 'codecov.yml'
✔ Adding '^codecov\\.yml$' to '.Rbuildignore'
✔ Adding Codecov test coverage badge to 'README.Rmd'
● Re-knit 'README.Rmd'
● Add to '.travis.yml':
  after_success:
    - Rscript -e 'covr::codecov()'
```



---

## Code coverage

- Sur [**https://codecov.io**](https://codecov.io), vous devrez vous connecter avec
vos identifiants GitHub et ajouter le dépôt `{pkgmin}` à codecov

--

&lt;br /&gt;

- Recompilons le `README.Rmd` en `README.md`


```r
rmarkdown::render("README.Rmd")
```

--

&lt;br /&gt;

- Et ajoutons ces lignes au fichier `.travis.yml` (ne pas oublier d'ajouter le package `{covr}` dans les packages requis pour Travis CI)

```
  after_success:
    - Rscript -e 'covr::codecov()'
```

--

- Après un _push_ (et quelques minutes d'attente) :

.left[![:scale 60%](assets/img/codecov-badge.png)]



---

## Etat du projet

.pull-left[.left[![:scale 45%](assets/img/git-final-l.png)]]

.pull-right[.right[![:scale 100%](assets/img/git-final-r.png)]]



---

## Pour aller plus loin

- Associer un DOI à son package :  [**Zenodo**](https://zenodo.org)

- Lifecycle du package : [`lifecycle`](https://cran.r-project.org/web/packages/lifecycle/vignettes/lifecycle.html)

- Ajouter d'autres badges : `usethis::use_badge()`

- Ajouter un logo à son package : [`hexSticker`](https://cran.r-project.org/web/packages/hexSticker/readme/README.html)

- Découvrez les [**GitHub actions**](https://github.com/features/actions)

- Révision du package par les pairs : [**rOpenSci**](https://ropensci.org/blog/2017/09/01/nf-softwarereview/)

- Soumettre son package au [**CRAN**](https://cran.r-project.org/submit.html) : `devtools::submit_cran()`


&lt;br /&gt;

.center[
![](https://travis-ci.org/ahasverus/pkgmin.svg?branch=master)
![](https://ci.appveyor.com/api/projects/status/github/ahasverus/pkgmin?branch=master&amp;svg=true)
![](https://codecov.io/gh/ahasverus/pkgmin/branch/master/graph/badge.svg)
![](https://img.shields.io/badge/lifecycle-stable-brightgreen.svg)
![](https://img.shields.io/badge/License-MIT-yellow.svg)
![](https://zenodo.org/badge/223958446.svg)
]

&lt;br /&gt;

<i class="fas  fa-hand-point-right " style="color:#3f3f3f;"></i> &amp;nbsp;`pkgmin : `&amp;nbsp;&amp;nbsp;
[**\[Dépôt GitHub\]**](https://github.com/ahasverus/pkgmin/)&amp;nbsp;&amp;nbsp;&amp;nbsp;
[**\[Site web\]**](https://ahasverus.github.io/pkgmin/)

---
class: inverse, center, middle

## A vous de jouer !

&lt;br /&gt;

.center[
  ![:scale 15%](assets/img/hex-devtools.png)
  &amp;nbsp;&amp;nbsp;&amp;nbsp;
  ![:scale 15%](assets/img/hex-usethis.png)
  &amp;nbsp;&amp;nbsp;&amp;nbsp;
  ![:scale 15%](assets/img/hex-roxygen2.png)

  ![:scale 15%](assets/img/hex-rmarkdown.png)
  &amp;nbsp;&amp;nbsp;&amp;nbsp;
  ![:scale 15%](assets/img/hex-pkgdown.png)
  &amp;nbsp;&amp;nbsp;&amp;nbsp;
  ![:scale 15%](assets/img/hex-testthat.png)

  ![:scale 15%](assets/img/travis-ci.png)
  &amp;nbsp;&amp;nbsp;&amp;nbsp;
  ![:scale 15%](assets/img/appveyor.png)
  &amp;nbsp;&amp;nbsp;&amp;nbsp;
  ![:scale 15%](assets/img/codecover.png)
]




    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="../../assets/libs/macros.js"></script>
<script>var slideshow = remark.create({
"ratio": "4:3",
"highlightStyle": "zenburn",
"highlightLines": false,
"countIncrementalSlides": false,
"slideNumberFormat": "%current% / %total%"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
