---
title: "<br />Introduction to `renv`"
subtitle: "<i>Project-local R dependencies management</i>"
date: .inst[December 2021]
author: <br /><br /><br />Nicolas Casajus
output:
  xaringan::moon_reader:
    css: ["assets/css/xaringan-themer.css", "assets/css/custom.css"]
    lib_dir: "assets/libs"
    seal: true
    yolo: false
    self_contained: false
    nature:
      ratio: "4:3"
      titleSlideClass: ["right", "middle"]
      highlightStyle: 'zenburn'
      highlightLines: true
      countIncrementalSlides: false
      slideNumberFormat: "%current% / %total%"
      beforeInit: "assets/libs/macros.js"
---



## Degrees of Reproducibility

`r fontawesome::fa_i("thumbs-up", class = "emph")` &nbsp;Research compendium<br/>
`r fontawesome::fa_i("thumbs-up", class = "emph")` &nbsp;Version control<br/>
`r fontawesome::fa_i("thumbs-up", class = "emph")` &nbsp;Code refactoring<br/>
`r fontawesome::fa_i("thumbs-up", class = "emph")` &nbsp;Literate programming

--

<br/>

What about R packages (and their versions)&nbsp;`r fontawesome::fa_i("question-circle")`

--

  - What are the packages versions used for my project?
  - Will my project be usable on other system or in the future?
  - How to deal with projects requiring different versions of a package?
  


---

## The package `renv`

.pull-leftt[
.center[[![:scale 75%](https://raw.githubusercontent.com/rstudio/renv/master/man/figures/logo.svg)](https://rstudio.github.io/renv/articles/renv.html)]
]

.pull-rightt[
- Developed by [**Kevin Ushey**](https://kevinushey.github.io/), also maintainer of the package [`reticulate`](https://rstudio.github.io/reticulate/)
- [`renv`](https://rstudio.github.io/renv/articles/renv.html) is a toolkit used to manage project-local libraries of `r fontawesome::fa_i("r-project")` packages
- `renv` is the successor of [`packrat`](https://rstudio.github.io/packrat/)
]

--

`renv` makes your project more:

`r fontawesome::fa_i("hand-point-right", class = "emph")` &nbsp;**Isolated**: 
each project has its own library of `r fontawesome::fa_i("r-project")` packages.

`r fontawesome::fa_i("hand-point-right", class = "emph")` &nbsp;**Portable** and **reproducible**: 
`renv` captures the state of your `r fontawesome::fa_i("r-project")` packages 
within a _lockfile_.

--

<br/>

Inspired from `r fontawesome::fa_i("python")` and the `venv` module.

---

## Libraries _vs_ packages

--

`r fontawesome::fa_i("hand-point-right")` &nbsp;`Package` - a 
collection of `r fontawesome::fa_i("r-project")` functions, data, and compiled 
code in a well-defined format. 

`r fontawesome::fa_i("hand-point-right")` &nbsp;`Library` - the 
directory into which packages are installed.


--

<br />

By default, `r fontawesome::fa_i("r-project")` has two (or more) libraries:

```{r eval=FALSE}
.libPaths()
## [1] "/Users/nicolascasajus/Library/R/4.0/library"
## [2] "/Library/Frameworks/R.framework/Versions/4.0/Resources/library"
```

The first is the **user** library and the second the **system** library.

--

<br/>

```{r eval=FALSE}
find.package("rmarkdown")
## [1] "/Users/nicolascasajus/Library/R/4.0/library/rmarkdown"

find.package("base")
## [1] "/Library/Frameworks/R.framework/Resources/library/base"
```

---

## Libraries _vs_ packages

.center[
![:scale 75%](assets/img/library-1.png)
]


---

## Global package cache

.pull-left[.center[![:scale 95%](assets/img/library-1.png)]]
.pull-right[.center[![:scale 95%](assets/img/library-2a.png)]]


---

## Global package cache

.pull-left[.center[![:scale 95%](assets/img/library-1.png)]]
.pull-right[.center[![:scale 95%](assets/img/library-2b.png)]]


---

## Initialization

- Command line

```{r eval=FALSE}
## Initiate renv for the project ----
renv::init()
```

<br/>

- With RStudio

.center[![:scale 50%](assets/img/rstudio-renv.png)]

---

## Infrastructure


---

## The local environment



---

## Adding packages



---

## Removing packages



---

## Cleaning the local environment



---

## The `DESCRIPTION` file



---

## Collaborating with `renv`


---

## Saving the local environment



---

## Restoring the local environment



---

## Resources

- https://environments.rstudio.com/docker
- https://kevinushey-2020-rstudio-conf.netlify.app/slides.html
- https://elise.maigne.pages.mia.inra.fr/2021_package_renv/presentation.html
- https://rstudio.github.io/renv/articles/renv.html
- https://maxmasnick.com/kb/rlang/package-management/
- https://6chaoran.wordpress.com/2020/07/20/introduction-of-renv-package/
- https://rpubs.com/glennwithtwons/reproducible-r-toolbox


---

## Other features



---

## Wrap-up

```{r eval=FALSE}
## Initiate renv for the project ----
renv::init()

## Install < pkg_name > for the project ----
renv::install("pkg_name")

## Install packages listed in the DESCRIPTION file ----
renv::install()   # or, remotes::install_deps()

## Remove unnecessary packages ----
renv::remove("pkg_name")

## Check renv status ----
renv::status()

## Update list of required packages ----
renv::clean()

## Save local environment ----
renv::snapshot()

## Restore local environment ----
renv::restore()

## Deactivate local environment ----
renv::deactivate()

## (Re)activate local environment ----
renv::activate()
```
